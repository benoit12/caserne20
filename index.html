<!DOCTYPE html>
<html>
<head>
  <title>Carte Caserne 20</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #map {
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    async function fetchApiKey() {
      try {
        // Fetch the API key from the Azure App Configuration
        const response = await fetch('/.azureappconfig/configurations/latest?keys=GoogleMapsApiKey');
        const data = await response.json();
        const apiKey = data['GoogleMapsApiKey'];

        // Replace the placeholder with the actual API key in the Google Maps script URL
        const googleMapsScript = document.createElement('script');
        googleMapsScript.src = `https://maps.googleapis.com/maps/api/js?key=${apiKey}&callback=initMap`;
        googleMapsScript.defer = true;
        googleMapsScript.async = true;
        document.body.appendChild(googleMapsScript);
      } catch (error) {
        console.error('Error fetching the API key:', error);
      }
    }

    function initMap() {
      // Set the default starting location to Sainte-Marthe, QC, J0P1W0
      const mapCenter = { lat: 45.3711, lng: -74.3331 };

      // Create a new map instance
      const map = new google.maps.Map(document.getElementById('map'), {
        center: mapCenter,
        zoom: 12 // Zoom level (0 = World view, 20 = Building view)
      });

      // Create a marker at the center of the map
      const marker = new google.maps.Marker({
        position: mapCenter,
        map: map,
        title: 'Hello World!'
      });

      // Create an info window for the marker
      const infoWindow = new google.maps.InfoWindow({
        content: 'This is the marker location: Sainte-Marthe, QC, J0P1W0'
      });

      // Open the info window when the marker is clicked
      marker.addListener('click', function() {
        infoWindow.open(map, marker);
      });
    }

    // Call the fetchApiKey function to get the API key and load the Google Maps script
    fetchApiKey();
  </script>
</body>
</html>
